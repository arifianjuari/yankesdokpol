name: Deploy ke Hostinger via FTP

on:
  push:
    branches:
      - main

  workflow_dispatch:  # Menambahkan opsi trigger manual di GitHub Actions

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 30  # Menambahkan timeout di tingkat job
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 2  # Mengambil hanya 2 commit terakhir untuk mempercepat

      - name: Deploy via FTP
        # Back to SamKirkland's FTP action with proper configuration
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          # Shared hosting configuration
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          protocol: ftp
          port: 21
          local-dir: ./
          server-dir: /public_html/yankesdokpol/
          timeout: 60000
          dangerous-clean-slate: false
          # Exclude files and directories that shouldn't be deployed
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/vendor/**
            upload/**
            **/uploads/**
            **/.DS_Store
            **/Thumbs.db
            .env
            .env.example
            .env.local
            README.md
            LICENSE
            composer.lock
            package-lock.json
            yarn.lock
            .vscode/**
            .idea/**
            **/logs/**
            **/temp/**
            **/tmp/**
            **/cache/**
            **/*.log
            **/*.bak
            **/*.swp
            **/*.sql
            **/*.zip
            **/*.tar
            **/*.gz
            **/*.rar
            sshkey
            **/*.psd
            **/*.ai
            **/*.sketch