name: Deploy ke Hostinger via FTP

on:
  push:
    branches:
      - main

  workflow_dispatch:  # Menambahkan opsi trigger manual di GitHub Actions

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 30  # Menambahkan timeout di tingkat job
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 2  # Mengambil hanya 2 commit terakhir untuk mempercepat

      # Prepare deployment files by excluding what we don't want to upload
      - name: Create deployment directory
        run: |
          mkdir -p ./deploy_folder
          rsync -av --exclude='.git/' --exclude='node_modules/' --exclude='vendor/' --exclude='upload/' --exclude='uploads/' --exclude='.github/' --exclude='.DS_Store' --exclude='Thumbs.db' --exclude='.env' --exclude='.env.example' --exclude='.env.local' --exclude='README.md' --exclude='LICENSE' --exclude='composer.lock' --exclude='package-lock.json' --exclude='yarn.lock' --exclude='.vscode/' --exclude='.idea/' --exclude='logs/' --exclude='temp/' --exclude='tmp/' --exclude='cache/' --exclude='*.log' --exclude='*.bak' --exclude='*.swp' --exclude='*.sql' --exclude='*.zip' --exclude='*.tar' --exclude='*.gz' --exclude='*.rar' --exclude='sshkey' --exclude='*.psd' --exclude='*.ai' --exclude='*.sketch' ./ ./deploy_folder/

      - name: Deploy to Hostinger
        uses: sebastianpopp/ftp-action@releases/v2
        with:
          host: ${{ secrets.FTP_HOST }}
          user: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          localDir: "./deploy_folder"
          remoteDir: "/public_html/yankesdokpol"
          options: "--delete --ascii"